spring.application.name=investment-data-scanner-service

# Tinkoff API
tinkoff.api.token=${TINKOFF_API_TOKEN}
server.port=${SERVER_PORT:8085}

# Datasource (PostgreSQL)
spring.datasource.url=${DB_URL}
spring.datasource.username=${DB_USERNAME}
spring.datasource.password=${DB_PASSWORD}
spring.datasource.driver-class-name=org.postgresql.Driver

# JPA / Hibernate

spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect

# Scheduling

# Application timezone (for deviation and timestamp calculations)
app.timezone=${APP_TIMEZONE:Europe/Moscow}

# Install schema  invest in search_path for all connections HikariCP
spring.datasource.hikari.maximum-pool-size=20
spring.datasource.hikari.connection-init-sql=SET search_path TO invest, public;

logging.level.org.springframework.jdbc=DEBUG
logging.level.com.example.investmentdatascannerservice.service.QuoteScannerService=DEBUG
logging.level.com.example.investmentdatascannerservice.service.InstrumentPairService=DEBUG
logging.level.com.example.investmentdatascannerservice.controller.QuoteWebSocketController=DEBUG
logging.level.com.example.investmentdatascannerservice.controller.PairWebSocketController=DEBUG

# Jackson Configuration
spring.jackson.serialization.write-dates-as-timestamps=false
spring.jackson.deserialization.fail-on-unknown-properties=false

# Actuator Configuration
management.endpoints.web.exposure.include=health,info,metrics,prometheus,circuitbreakers
management.endpoint.health.show-details=always
management.metrics.export.prometheus.enabled=true

# Resilience4j Configuration
resilience4j.circuitbreaker.instances.tinvest-api.failure-rate-threshold=50
resilience4j.circuitbreaker.instances.tinvest-api.wait-duration-in-open-state=30s
resilience4j.circuitbreaker.instances.tinvest-api.sliding-window-size=10
resilience4j.circuitbreaker.instances.tinvest-api.minimum-number-of-calls=5
resilience4j.circuitbreaker.instances.tinvest-api.permitted-number-of-calls-in-half-open-state=3
resilience4j.circuitbreaker.instances.tinvest-api.automatic-transition-from-open-to-half-open-enabled=true
resilience4j.circuitbreaker.instances.tinvest-api.slow-call-rate-threshold=50
resilience4j.circuitbreaker.instances.tinvest-api.slow-call-duration-threshold=5s

# Retry Configuration
resilience4j.retry.instances.tinvest-api.max-attempts=3
resilience4j.retry.instances.tinvest-api.wait-duration=1s
resilience4j.retry.instances.tinvest-api.retry-exceptions=java.net.ConnectException,java.net.SocketTimeoutException,java.util.concurrent.TimeoutException

# TimeLimiter Configuration
resilience4j.timelimiter.instances.tinvest-api.timeout-duration=10s
resilience4j.timelimiter.instances.tinvest-api.cancel-running-future=true

# Quote Scanner Configuration
quote-scanner.max-quotes-per-second=10000
quote-scanner.enable-database-saving=false
quote-scanner.enable-websocket-broadcast=true
quote-scanner.enable-order-book-subscription=true
quote-scanner.order-book-depth=1
quote-scanner.enable-immediate-order-book-updates=true
quote-scanner.max-order-book-updates-per-second=0
quote-scanner.enable-test-mode=true
quote-scanner.enable-shares-mode=true

# Отключаем сохранение в БД для максимальной производительности
spring.jpa.hibernate.ddl-auto=none
spring.jpa.show-sql=false
logging.level.org.hibernate=WARN

# Конфигурация инструментов для отслеживания
# В режиме shares-mode (enable-shares-mode=true) инструменты загружаются из таблицы invest.shares
# В обычном режиме можно указать конкретные инструменты здесь
# quote-scanner.instruments[0]=BBG004730N88
# quote-scanner.instruments[1]=BBG0047315Y7
# ... другие инструменты

# Имена инструментов для отображения
# В режиме shares-mode имена загружаются из таблицы invest.shares
# В обычном режиме можно указать имена здесь
# quote-scanner.instrument-names.BBG004730N88=SBER
# quote-scanner.instrument-names.BBG0047315Y7=SBERP
# ... другие имена

# Instrument Pairs Configuration
# Пары инструментов (добавляйте по необходимости)
instrument-pairs.pairs[0].pair-id=1
instrument-pairs.pairs[0].first-instrument=BBG004730N88
instrument-pairs.pairs[0].second-instrument=BBG0047315Y7
instrument-pairs.pairs[0].first-instrument-name=SBER
instrument-pairs.pairs[0].second-instrument-name=SBERP

instrument-pairs.pairs[1].pair-id=2
instrument-pairs.pairs[1].first-instrument=BBG000MZL0Y6
instrument-pairs.pairs[1].second-instrument=BBG000MZL2S9
instrument-pairs.pairs[1].first-instrument-name=PMSB
instrument-pairs.pairs[1].second-instrument-name=PMSBP

instrument-pairs.pairs[2].pair-id=3
instrument-pairs.pairs[2].first-instrument=BBG004S68598
instrument-pairs.pairs[2].second-instrument=BBG004S68FR6
instrument-pairs.pairs[2].first-instrument-name=MTLR
instrument-pairs.pairs[2].second-instrument-name=MTLRP

instrument-pairs.pairs[3].pair-id=4
instrument-pairs.pairs[3].first-instrument=BBG004RVFFC0
instrument-pairs.pairs[3].second-instrument=BBG004S68829
instrument-pairs.pairs[3].first-instrument-name=TATN
instrument-pairs.pairs[3].second-instrument-name=TATNP

instrument-pairs.pairs[4].pair-id=5
instrument-pairs.pairs[4].first-instrument=BBG004S682Z6
instrument-pairs.pairs[4].second-instrument=BBG004S685M3
instrument-pairs.pairs[4].first-instrument-name=RTKM
instrument-pairs.pairs[4].second-instrument-name=RTKMP

instrument-pairs.pairs[5].pair-id=6
instrument-pairs.pairs[5].first-instrument=FUTSBRF09250
instrument-pairs.pairs[5].second-instrument=FUTSBPR09250
instrument-pairs.pairs[5].first-instrument-name=SRU5
instrument-pairs.pairs[5].second-instrument-name=SPU5

instrument-pairs.pairs[6].pair-id=7
instrument-pairs.pairs[6].first-instrument=FUTTATN09250
instrument-pairs.pairs[6].second-instrument=FUTTATP09250
instrument-pairs.pairs[6].first-instrument-name=TTU5
instrument-pairs.pairs[6].second-instrument-name=TPU5